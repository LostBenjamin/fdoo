<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
      
        <!-- Project -->
        <record id="form_project_view" model="ir.ui.view">
            <field name="name">project.form_project_view</field>
            <field name="model">project.project</field>
            <field name="type">form</field>
            <field name="priority">99</field>
            <field name="arch" type="xml">
                <form string="Project">
                    <group colspan="6" col="6">                    	
                        <field name="name" string="Project Name" select="1"/>
                        <field name="parent_id" string="Parent" domain="[('id','!=',analytic_account_id)]" context="{'current_model': 'project.project'}"/>
                        <field name="user_id" string="Project Manager" select="1" attrs="{'readonly':[('state','in',['close', 'cancelled'])]}"/>
                        <field name="date_start" string="Start Date" attrs="{'readonly':[('state','in',['close', 'cancelled'])]}"/>
                        <field name="date" string="End Date" attrs="{'readonly':[('state','in',['close', 'cancelled'])]}"/>
                        <field name="progress_rate" widget="progressbar"/>
                    </group>
                    <notebook colspan="4">
                    	<page string="Notes">
                            <field colspan="4" name="description" nolabel="1"/>
                        </page>                 
                        <page string="Members">
                            <field colspan="4" name="members" nolabel="1">
                                <tree string="Members">
                                    <field name="name"/>
                                    <field name="user_email"/>
                                    <field name="address_id"/>
                                </tree>
                            </field>
                        </page>                        
                    </notebook>
                    <newline/>                       
                    <group col="6" colspan="4">
                        <field name="state" select="1"/>
                        <label string=""/>  
                        <button name="do_cancel" states="draft,open,pending" string="Cancel" type="object" icon="gtk-cancel"/>                      
                        <button name="do_draft" states="open" string="Draft" type="object" icon="gtk-indent"/>
                        <button name="do_open" states="pending,draft" string="Start Task" type="object" icon="gtk-execute"/>                        
                    </group>
                </form>
            </field>
        </record>

 		<record id="tree_project_view" model="ir.ui.view">
            <field name="name">project.tree_project_view</field>
            <field name="model">project.project</field>
            <field name="type">tree</field>
            <field name="field_parent">child_ids</field>
            <field name="priority">99</field>
            <field name="arch" type="xml">
                <tree colors="red:date and (date&lt;current_date) and (state in ('open'));blue:state in ('draft','pending');grey: state in ('close','cancelled')" string="Projects">
                    <field name="sequence" invisible="1"/>
                    <field name="date" invisible="1"/>
                    <field name="parent_id" string="Parent" invisible="1"/>
                    <field name="name" string="Project Name"/>
                    <field name="user_id" string="Project Manager"/>
                    <field name="planned_hours" widget="float_time"/>
                    <field name="total_hours" widget="float_time"/>
                    <field name="effective_hours" widget="float_time"/>
                    <field name="progress_rate" widget="progressbar"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        
       <record id="search_project" model="ir.ui.view">
            <field name="name">project.search_project</field>
            <field name="model">project.project</field>
            <field name="type">search</field>
            <field name="priority">99</field>
            <field name="arch" type="xml">
                <search string="Search Project">
                   <group col='15' colspan='4'>
                       <filter icon="terp-check" string="Current" name="current" domain="[('state', 'in',('open','pending'))]" help="Open and Pending Projects"/>
                       <separator orientation="vertical"/>
                       <field name="name" string="Project Name"/>
                       <field name="user_id" string="Project Manager"/>
                   </group>
                   <newline />
                   <group expand="0" string="Group By..." colspan="4" col="20" groups="base.group_extended">
                        <filter string="Manager" name="Manager"  icon="terp-personal" domain = "[]" context="{'group_by':'user_id'}"/>                        
                        <filter string="Parent" name="Parent"  help="Parent" icon="terp-folder-blue" domain = "[]" context="{'group_by':'parent_id'}"/>
                   </group>
               </search>
            </field>
        </record>
    

        <record id="action_view_project_all" model="ir.actions.act_window">
            <field name="name">Projects</field>
            <field name="res_model">project.project</field>
            <field name="view_type">form</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,form,gantt</field>
            <field name="view_id" ref="tree_project_view"/>
            <field name="search_view_id" ref="search_project"/>
            <field name="context">{'search_default_current':1}</field>
            <field name="help">A project contains a set of tasks or issues that will be performed by your resources assigned to it. A project can be hierarchically structured, as a child of a Parent Project. This allows you to design large project structures with different phases spread over the project duration cycle. Each user can set his default project in his own preferences to automatically filter the tasks or issues he usually works on. If you choose to invoice the time spent on a project task, you can find project tasks to be invoiced in the billing section.</field>
        </record>     
        <record id="action_view_project_all_tree" model="ir.actions.act_window.view">
         	<field name="sequence" eval="1"/>
         	<field name="view_mode">tree</field>
         	<field name="view_id" ref="tree_project_view"/>
         	<field name="act_window_id" ref="action_view_project_all"/>
         </record>       	
       	<record id="action_view_project_all_form" model="ir.actions.act_window.view">
         	<field name="sequence" eval="2"/>
         	<field name="view_mode">form</field>
         	<field name="view_id" ref="form_project_view"/>
         	<field name="act_window_id" ref="action_view_project_all"/>
        </record>         
        
            	
        <!-- Task -->
        <record id="form_task_view" model="ir.ui.view">
            <field name="name">project.form_task_view</field>
            <field name="model">project.task</field>
            <field name="type">form</field>
            <field name="priority">99</field>
            <field name="arch" type="xml">
                <form string="Task edition">
                    <group colspan="6" col="6">
                        <field name="name" select="1"/>
                        <field name="project_id" select="1"  on_change="onchange_project(project_id)"/>
                        <field name="total_hours" widget="float_time"/>
                        <field name="date_deadline" attrs="{'readonly':[('state','in',['done', 'cancelled'])]}"/>
                        <field name="user_id" select="1" attrs="{'readonly':[('state','in',['done', 'cancelled'])]}"/>
                        <field name="progress" widget="progressbar"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Information">
                            <group col="2" colspan="2">
                                <field name="planned_hours"   widget="float_time" readonly="1"/>                                
                                <field name="effective_hours" widget="float_time" invisible="1"/>
                            </group>
                            <group col="3" colspan="2">
                                <field name="remaining_hours" widget="float_time" readonly="1" icon="gtk-edit"/>
                            </group>
                            <field colspan="4" name="description" nolabel="1"  attrs="{'readonly':[('state','=','done')]}" widget="text_wiki"/>
                            <field colspan="4" name="work_ids" nolabel="1" attrs="{'invisible':[('state','in',['draft'])],'readonly':[('state','=','done')]}">
                                <tree string="Task Work" editable="top">
                                    <field name="name" />
                                    <field name="hours" widget="float_time" sum="Spent Hours"/>
                                    <field name="user_id" />
                                    <field name="date" />
                                </tree>
                            </field>
                            <newline/>
                            <group col="9" colspan="4">
                                <field name="state" select="1"/>
                                <button name="do_cancel" states="draft,open,pending" string="Cancel" type="object" icon="gtk-cancel"/>
                                <button name="do_draft" states="open" string="Draft" type="object" icon="gtk-indent"/>
                                <button name="do_open" states="pending,draft" string="Start Task" type="object" icon="gtk-execute"/>                                
                                <button name="do_pending" states="open" string="Pending" type="object" icon="gtk-media-pause"/>                                
                                <button name="action_close" states="pending,open" string="Done" type="object" icon="terp-dialog-close"/>
                            </group>
                        </page>                       
                    </notebook>
                </form>
            </field>
        </record>

        <record id="tree_task_view" model="ir.ui.view">
            <field name="name">project.tree_task_view</field>
            <field name="model">project.task</field>
            <field name="type">tree</field>
            <field name="priority">99</field>
            <field name="arch" type="xml">
                <tree colors="grey:state in ('cancelled','done');blue:state == 'pending';red:date_deadline and (date_deadline&lt;current_date) and (state in ('draft','pending','open'))" string="Tasks">
                    <field name="sequence" invisible="not context.get('seq_visible', False)"/>
                    <field name="name"/>
                    <field name="project_id" icon="gtk-indent" invisible="context.get('user_invisible', False)"/>
                    <field name="user_id" invisible="context.get('user_invisible', False)"/>                    
                    <field name="total_hours" invisible="1"/>
                    <field name="planned_hours"/>
                    <field name="effective_hours" widget="float_time" sum="Spent Hours" invisible="1"/>
                    <field name="remaining_hours" widget="float_time" sum="Remaining Hours" on_change="onchange_remaining(remaining_hours,planned_hours)"/>
                    <field name="date_deadline" invisible="context.get('deadline_visible',True)"/>
                    <field name="type_id" invisible="context.get('set_visible',False)"/>
                    <button name="next_type" invisible="context.get('set_visible',False)"
                        states="draft,open,pending"
                        string="Change Stage"
                        type="object"
                        icon="gtk-go-forward"
                        groups="base.group_extended"
                        help="Change Type"/>
                    <field name="date_start" invisible="1"/>
                    <field name="date_end" invisible="1"/>
                    <field name="progress" widget="progressbar" invisible="context.get('set_visible',False)"/>
                    <field name="state" invisible="context.get('set_visible',False)"/>                    
                    <button name="do_cancel" states="draft,open,pending" string="Cancel" type="object" icon="gtk-cancel" help="For cancelling the task"/>
                    <button name="do_open" states="pending,draft,done,cancelled" string="Start Task" type="object" icon="gtk-execute" help="For changing to open state" invisible="context.get('set_visible',False)"/>                    
                    <button name="action_close" states="draft,pending,open" string="Done" type="object" icon="terp-dialog-close" help="For changing to done state"/>
                </tree>
            </field>
        </record>

        <record id="search_task_view" model="ir.ui.view">
            <field name="name">project.search_task_view</field>
            <field name="model">project.task</field>
            <field name="type">search</field>
            <field name="priority">99</field>
            <field name="arch" type="xml">
               <search string="Task Edition">
                    <group col="20" colspan="4">
                        <filter string="Current" domain="[('state','in',('open','draft'))]"  name="current" help="Draft and In Progress tasks" icon="terp-check"/>
                        <filter string="In Progress" domain="[('state','=','open')]" help="In Progress Tasks" icon="terp-camera_test"/>
                        <filter string="Pending" domain="[('state','=','pending')]" context="{'show_delegated':False}" help="Pending Tasks" icon="terp-gtk-media-pause"/>
                        <separator orientation="vertical"/>
                        <filter name="edit"
                            string="Edit" context="{'set_editable':True,'seq_visible': True}"
                            icon="gtk-execute"
                            groups="base.group_extended"/>
                        <separator orientation="vertical"/>                       
                        <field name="name" select="1"/>                        
                    </group>
                    <newline/>
                    <group expand="0" string="Group By..." colspan="4" col="20">
                        <filter string="Users" name="group_user_id" icon="terp-personal" domain="[]"  context="{'group_by':'user_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Project" name="group_project_id" icon="terp-folder-violet" domain="[]" context="{'group_by':'project_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Stage" name="group_stage_id" icon="terp-stage" domain="[]" context="{'group_by':'type_id'}"/>
                        <filter string="State" name="group_state" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Deadline" icon="terp-gnome-cpu-frequency-applet+" domain="[]" context="{'group_by':'date_deadline'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Start Date" icon="terp-go-month" domain="[]" context="{'group_by':'date_start'}"/>
                        <filter string="End Date" icon="terp-go-month" domain="[]" context="{'group_by':'date_end'}"/>
                    </group>
                </search>
            </field>
        </record>
      
        <record id="action_view_task" model="ir.actions.act_window">
            <field name="name">Tasks</field>
            <field name="res_model">project.task</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,gantt,graph</field>                                    
            <field name="search_view_id" ref="search_task_view"/>
            <field name="context">{'search_default_current':1}</field>
            <field name="help">A task represents a work that has to be done. Each user works in his own list of tasks where he can record his task work in hours. He can work and close the task itself or delegate it to another user. If you delegate a task to another user, you get a new task in pending state, which will be reopened when you have to review the work achieved. If you install the project_timesheet module, task work can be invoiced based on the project configuration. With the project_mrp module, sales orders can create tasks automatically when they are confirmed.</field>
        </record> 
        <record id="action_view_task_tree" model="ir.actions.act_window.view">
         	<field name="sequence">1</field>
         	<field name="view_mode">tree</field>
         	<field name="view_id" ref="tree_task_view"/>
         	<field name="act_window_id" ref="action_view_task"/>
        </record>       	
       	<record id="action_view_task_form" model="ir.actions.act_window.view">
         	<field name="sequence">2</field>
         	<field name="view_mode">form</field>
         	<field name="view_id" ref="form_task_view"/>
         	<field name="act_window_id" ref="action_view_task"/>
        </record>
                    
            
    </data>
</openerp>
